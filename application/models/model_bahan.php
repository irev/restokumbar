<?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');class Model_bahan extends CI_Controller{	function __Construct(){		parent::__Construct();		$this->load->database();	}		function CountData(){		 return $this->db->count_all('bahan');	}		function ReadData($limit, $start) {        $this->db->limit($limit, $start);		$this->db->order_by("no_bahan", "asc");        $query = $this->db->get('bahan');        if ($query->num_rows() > 0) {            foreach ($query->result() as $row) {                $data[] = $row;            }            return $data;        }        return false;   }      function Supplier(){		$data = array();		$this->db->order_by("nama", "asc");		$query = $this->db->get('supplier');		if($query->num_rows()>0){			foreach($query->result_array() as $row){				$data[] = $row;			}		}		$query->free_result();		return $data;   }      function Satuan(){		$data = array();		$this->db->order_by("value", "asc");		$query = $this->db->get('satuan');		if($query->num_rows()>0){			foreach($query->result_array() as $row){				$data[] = $row;			}		}		$query->free_result();		return $data;   }      function Save($data){		$this->db->insert('bahan',$data);   }      function Edit($no_bahan){		$data = array();		$this->db->where('no_bahan',$no_bahan);		$query = $this->db->get('bahan');		if($query->num_rows()>0){			foreach($query->result_array() as $row){				$data[] = $row;			}		}		$query->free_result();		return $data;	}   	function Update($data,$no_bahan){		$this->db->where('no_bahan',$no_bahan);		$this->db->update('bahan',$data);	}   	function Delete($no_bahan){		$this->db->where('no_bahan',$no_bahan);			$this->db->delete('bahan');		$data = $this->CountData();		if($data==0){			$this->db->query('TRUNCATE bahan');		}	}		function ListPencarian(){		$data = array();		$query = $this->db->query("DESC bahan");		if($query->num_rows()>0){			foreach($query->result_array() as $row){				$data[] = $row;			}		}		$query->free_result();		return $data;	}		function SearchData($limit, $start,$kategori,$value) {        $this->db->limit($limit, $start);		$this->db->like($kategori, $value);        $query = $this->db->get('bahan');        if ($query->num_rows() > 0) {            foreach ($query->result() as $row) {                $data[] = $row;            }            return $data;        }        return false;   }      function CreateID(){		$new_id = '';		$last_id = '';		$this->db->select_max('no_bahan','id');		$query = $this->db->get('bahan');		if($query->num_rows()>0){			foreach($query->result() as $row){				$last_id =  $row->id;			}		}		$last_index = substr($last_id,1,3); 		if($last_id==null){			$new_id = 'B001'; 		}		else {			if($last_index>=1000){				$new_id = ''.($last_index+1);			}else{				$zero = 0;				$count_index = strlen($last_index); // Hitung jumlah karakter '00001'				for($i=0;$i<$count_index;$i++){					if(substr($last_index,$i,1)=="0"){						$zero++;  // Hitung jumlah nol					}				}				$current_index = substr($last_index,$zero); // index current '1'				if($current_index==9||$current_index==99||$current_index==999||$current_index==9999){					$zero = $zero -1;				}								$new_id = 'B'.substr($last_index,0,$zero)."".($current_index+1);			}		}		return $new_id;	}		function UpdateStok($id){		$this->db->query("			UPDATE bahan SET stok = stok - 1 WHERE no_bahan = '".$id."' 		");	}	}